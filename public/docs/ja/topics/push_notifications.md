# プッシュ通知

**要約：** A2Aは、リモートエージェントとクライアント間のプッシュ通知を可能にします。

<!-- TOC -->

- [プッシュ通知](#プッシュ通知)
  - [基本ワークフロー](#基本ワークフロー)
  - [設定](#設定)
  - [ルール](#ルール)
  - [JSON-RPCイベント](#json-rpcイベント)
  - [検証](#検証)

<!-- /TOC -->

## 基本ワークフロー

プッシュ通知は、クライアントとエージェント間の接続が切断された場合に、エージェントがクライアントに更新を通知できるように
します。基本ワークフローは以下の通りです：

1. クライアントはエージェントにタスクを送信します
2. エージェントはタスクを受け取り、処理を開始します
3. クライアントは接続を切断します
4. エージェントはタスクの完了時にプッシュ通知を送信します
5. クライアントは通知を受け取り、タスクの結果を取得します

## 設定

プッシュ通知を有効にするには、以下の設定が必要です：

1. **エージェント側**

   - プッシュ通知サービスの設定
   - 通知エンドポイントの公開
   - 認証情報の管理

2. **クライアント側**
   - 通知受信エンドポイントの設定
   - 通知の処理ロジックの実装
   - セキュリティ設定の構成

## ルール

プッシュ通知の実装には以下のルールが適用されます：

1. **通知の形式**

   - JSON-RPC 2.0形式に準拠
   - 必要なメタデータを含む
   - 暗号化されたペイロード

2. **配信保証**

   - 少なくとも1回の配信を保証
   - 重複通知の処理
   - エラー時の再試行

3. **セキュリティ**
   - エンドツーエンドの暗号化
   - 認証と認可
   - 改ざん防止

## JSON-RPCイベント

プッシュ通知は以下のJSON-RPCイベントを使用します：

```json
{
  "jsonrpc": "2.0",
  "method": "task.update",
  "params": {
    "taskId": "string",
    "status": "string",
    "result": "object"
  }
}
```

## 検証

プッシュ通知の検証には以下の手順が必要です：

1. **送信者検証**

   - デジタル署名の確認
   - 送信元の認証
   - タイムスタンプの検証

2. **内容検証**

   - ペイロードの整合性チェック
   - スキーマ検証
   - ビジネスルールの適用

3. **配信確認**
   - 受信確認の送信
   - エラー処理
   - ログ記録
